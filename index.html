<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced AI Astrology & Numerology Analysis</title>
    <!-- Adding jsPDF and docx libraries for export functionality -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/docx@8.5.0/build/index.js"></script>
    <style>
        /* ... (All CSS from the previous version remains exactly the same) ... */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #3b4371 100%); color: #fff; min-height: 100vh; overflow-x: hidden; }
        .container { max-width: 1600px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; padding: 40px 0; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(15px); border-radius: 25px; margin-bottom: 30px; border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3); }
        .header h1 { font-size: 3rem; margin-bottom: 10px; background: linear-gradient(45deg, #ffd700, #ffb347, #ff6b6b); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-shadow: 0 0 30px rgba(255, 215, 0, 0.5); }
        .nav-tabs { display: flex; gap: 10px; margin-bottom: 30px; flex-wrap: wrap; justify-content: center; }
        .nav-tab { padding: 15px 30px; border: none; border-radius: 25px; background: rgba(255, 255, 255, 0.1); color: #fff; cursor: pointer; transition: all 0.3s ease; backdrop-filter: blur(10px); font-size: 1rem; font-weight: 600; }
        .nav-tab.active { background: linear-gradient(45deg, #ffd700, #ffb347); color: #000; transform: translateY(-2px); box-shadow: 0 10px 20px rgba(255, 215, 0, 0.3); }
        .nav-tab:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(255, 255, 255, 0.2); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .input-section { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(15px); border-radius: 20px; padding: 30px; margin-bottom: 30px; border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); }
        .input-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .input-group { display: flex; flex-direction: column; gap: 8px; }
        .input-group label { font-weight: 600; color: #ffd700; font-size: 1.1rem; }
        .input-group input, .input-group select { padding: 12px 16px; border: 2px solid rgba(255, 255, 255, 0.2); border-radius: 10px; background: rgba(255, 255, 255, 0.1); color: #fff; font-size: 1rem; transition: all 0.3s ease; backdrop-filter: blur(10px); }
        .input-group input:focus, .input-group select:focus { outline: none; border-color: #ffd700; box-shadow: 0 0 15px rgba(255, 215, 0, 0.3); }
        .generate-btn { padding: 15px 40px; border: none; border-radius: 25px; background: linear-gradient(45deg, #ffd700, #ffb347); color: #000; font-weight: bold; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; font-size: 1.1rem; letter-spacing: 1px; box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3); }
        .generate-btn:hover { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(255, 215, 0, 0.5); }
        .results-section { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(15px); border-radius: 20px; padding: 30px; margin-bottom: 30px; border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); }
        .loading { display: none; text-align: center; padding: 40px; }
        .spinner { border: 4px solid rgba(255, 255, 255, 0.3); border-top: 4px solid #ffd700; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .error-message { display: none; background: rgba(255, 0, 0, 0.2); border: 2px solid rgba(255, 0, 0, 0.5); border-radius: 10px; padding: 15px; margin-bottom: 20px; color: #ff6b6b; text-align: center; }
        .report-section { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(15px); border-radius: 20px; padding: 30px; margin-bottom: 30px; border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); }
        .export-controls { display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center; }
        .export-btn { padding: 12px 24px; border: none; border-radius: 25px; background: linear-gradient(45deg, #28a745, #20c997); color: #fff; font-weight: bold; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; font-size: 0.9rem; letter-spacing: 0.5px; }
        .export-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(40, 167, 69, 0.4); }
    </style>
</head>
<body>
    <!-- Hidden SVG Logo for exports -->
    <div id="logo-container" style="display: none;">
        <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="#ffd700" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2z"></path>
            <path d="M12 12l-8 4.5"></path><path d="M12 12l8 4.5"></path>
            <path d="M12 12l-8-4.5"></path><path d="M12 12l8-4.5"></path>
            <path d="M12 12l0 9"></path><path d="M12 12l0-9"></path>
        </svg>
    </div>

    <div class="container">
        <div class="header">
            <h1>üåü Advanced AI Astrology & Numerology Analysis üåü</h1>
            <p>Generate a professional, detailed report of your cosmic blueprint.</p>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('astrology')">üåô Astrology</button>
            <button class="nav-tab" onclick="switchTab('numerology')">üî¢ Numerology</button>
            <button class="nav-tab" onclick="switchTab('reports')">üìä Reports</button>
        </div>

        <div id="errorMessage" class="error-message"></div>
        
        <!-- Astrology Tab -->
        <div id="astrology" class="tab-content active">
            <div class="input-section">
                <h2>üåü Generate Astrological Profile</h2>
                <div class="input-grid">
                    <div class="input-group">
                        <label for="fullName">Full Name</label>
                        <input type="text" id="fullName" placeholder="e.g., Jane Doe" value="Jane Doe">
                    </div>
                    <div class="input-group">
                        <label for="birthDate">Birth Date</label>
                        <input type="date" id="birthDate" value="1990-07-15">
                    </div>
                    <div class="input-group">
                        <label for="birthTime">Birth Time</label>
                        <input type="time" id="birthTime" value="14:30">
                    </div>
                </div>
                <button class="generate-btn" onclick="generateAstrologyReport()">üîÆ Generate Astrology Report</button>
            </div>
            <div class="loading" id="astrologyLoading"><div class="spinner"></div><p>AI is analyzing cosmic patterns...</p></div>
            <div class="results-section" id="astrologyResults" style="display: none;">
                <h2>‚úÖ Astrological Report Generated</h2>
                <p>Your detailed astrological profile is ready. You can now view it in the "Reports" tab and export it as a professional PDF or DOCX file.</p>
            </div>
        </div>
        
        <!-- Numerology Tab -->
        <div id="numerology" class="tab-content">
            <div class="input-section">
                <h2>üî¢ Generate Numerology Profile</h2>
                <div class="input-grid">
                    <div class="input-group">
                        <label for="numFullName">Full Name (as on birth certificate)</label>
                        <input type="text" id="numFullName" placeholder="e.g., Jane Elizabeth Doe" value="Jane Elizabeth Doe">
                    </div>
                    <div class="input-group">
                        <label for="numBirthDate">Birth Date</label>
                        <input type="date" id="numBirthDate" value="1990-07-15">
                    </div>
                </div>
                <button class="generate-btn" onclick="generateNumerologyReport()">üîÆ Generate Numerology Report</button>
            </div>
            <div class="loading" id="numerologyLoading"><div class="spinner"></div><p>AI is calculating your core numbers...</p></div>
            <div class="results-section" id="numerologyResults" style="display: none;">
                <h2>‚úÖ Numerology Report Generated</h2>
                <p>Your detailed numerology profile is ready. You can combine this with your astrology report in the "Reports" tab for a full cosmic analysis.</p>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reports" class="tab-content">
            <div class="report-section">
                <h2>üìä Download Your Professional Reports</h2>
                <p>Generate your Astrology and/or Numerology reports on the other tabs first. Then, click below to download them in a beautifully formatted PDF or Word document.</p>
                <div class="export-controls">
                    <button class="export-btn" onclick="exportPDF()">üìÑ Export as PDF</button>
                    <button class="export-btn" onclick="exportDOCX()">üìù Export as DOCX</button>
                </div>
                <div id="reportStatus"></div>
            </div>
        </div>
    </div>

    <script>
    // --- GLOBAL STATE & "AI" CONTENT LIBRARY --- //
    let generatedReportData = {};

    const ANALYSIS_CONTENT = {
        astrology: {
            sunSign: {
                Aries: "Your core identity (Sun) is in Aries, the sign of the warrior and pioneer. You are driven by a powerful need to initiate action, lead, and express your will. You possess immense courage, a direct nature, and a passion for new beginnings.",
                Taurus: "With your Sun in Taurus, your core essence is grounded, stable, and deeply connected to the material world. You are reliable, patient, and seek security and comfort. You have a strong appreciation for beauty, art, and the pleasures of life.",
                Gemini: "Your Sun in Gemini indicates a core identity that is curious, communicative, and adaptable. You are a natural networker and learner, driven by a desire to gather and share information. Your mind is your greatest asset.",
                Cancer: "As a Cancer Sun, your core being is tied to the realms of emotion, family, and security. You are deeply intuitive, nurturing, and protective of those you love. Your emotional intelligence is a significant strength.",
                Leo: "Your Sun in Leo marks you as a natural-born leader and performer. Your core identity radiates warmth, generosity, and a powerful creative life force. You are driven to express yourself and shine your light on the world.",
                Virgo: "With your Sun in Virgo, your core identity is focused on service, improvement, and practical details. You are analytical, diligent, and possess a keen eye for what can be made better. You find purpose in being helpful and efficient.",
                // ... (add all 12 signs)
            },
            moonSign: {
                Aries: "Your emotional world (Moon) is fiery and impulsive. You react to situations quickly and directly, with a need for emotional independence and honesty. You may feel restless if your feelings are suppressed.",
                Taurus: "Your Moon in Taurus gives you an emotional nature that is calm, steady, and seeks security. You need comfort and stability to feel emotionally centered. You are loyal and steadfast in your affections.",
                Gemini: "With a Gemini Moon, your emotional landscape is intellectual and communicative. You process feelings by talking about them and understanding them logically. You need mental stimulation to feel emotionally satisfied.",
                // ... (add all 12 signs)
            },
            ascendant: {
                Aries: "Your Ascendant, or rising sign, is Aries. This means you project an aura of confidence, assertiveness, and directness. People see you as a go-getter, someone who is not afraid to take the lead. Your approach to new situations is to dive in headfirst.",
                Taurus: "Your Taurus Ascendant gives you a calm, grounded, and often beautiful presence. You appear stable, patient, and perhaps a bit reserved at first. People are drawn to your quiet strength and reliability. You approach life with a steady, deliberate pace.",
                // ... (add all 12 signs)
            },
            planetsInHouses: {
                'Jupiter in 10th': "Jupiter, the planet of expansion and luck, is in your 10th House of Career and Public Image. This is a powerful placement for professional success. It indicates that your career path will be a source of immense growth, and you can achieve great public recognition and honor through your work. Your reputation is often your greatest asset.",
                'Saturn in 7th': "Saturn, the planet of discipline and lessons, in your 7th House of Partnerships, suggests that relationships are a key area of learning for you. You take commitments very seriously and seek a partner who is mature and reliable. Your path may involve learning to balance responsibility and freedom within your partnerships.",
                // ... (add many more combinations)
            }
        },
        numerology: {
            lifePath: {
                1: "As a Life Path 1, your journey is one of leadership, innovation, and independence. You are here to learn to trust your own ideas and pioneer new paths. Your greatest challenge and gift is to stand on your own two feet and lead with courage.",
                8: "Your Life Path is the 8, the number of power, authority, and material mastery. Your purpose involves learning to wield influence and manage resources effectively. You are on a journey to achieve great success while maintaining balance and integrity.",
                22: "You have the Master Number 22 Life Path, the 'Master Builder.' Your purpose is to turn grand dreams into tangible reality. You possess immense potential to create systems, institutions, or projects that benefit a large number of people. This path requires immense practicality and a grand vision.",
                 // ... (add all numbers 1-9, 11, 22, 33)
            },
            destiny: {
                5: "Your Destiny Number is 5, indicating that your potential is realized through freedom, adventure, and communication. You are meant to be a messenger, an agent of change, and someone who experiences life to the fullest. Adaptability is your key to success.",
                9: "With a Destiny Number of 9, your ultimate potential lies in humanitarianism, compassion, and creative expression on a grand scale. You are destined to inspire and uplift others, often through artistic or philanthropic endeavors. Your path is one of universal love and wisdom.",
                // ... (add all numbers)
            }
        }
    };
    
    // --- UTILITY & HELPER FUNCTIONS --- //
    function switchTab(tabName) {
        document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
        document.querySelector(`.nav-tab[onclick="switchTab('${tabName}')"]`).classList.add('active');
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        document.getElementById(tabName).classList.add('active');
    }

    function showLoading(loaderId, resultsId) {
        document.getElementById(loaderId).style.display = 'block';
        document.getElementById(resultsId).style.display = 'none';
        document.getElementById('errorMessage').style.display = 'none';
        document.getElementById('reportStatus').textContent = '';
    }

    function hideLoading(loaderId, resultsId) {
        document.getElementById(loaderId).style.display = 'none';
        document.getElementById(resultsId).style.display = 'block';
    }

    function showError(message) {
        const errorDiv = document.getElementById('errorMessage');
        errorDiv.textContent = message;
        errorDiv.style.display = 'block';
        document.querySelectorAll('.loading').forEach(loader => loader.style.display = 'none');
    }

    // --- REPORT GENERATION LOGIC --- //
    
    function generateAstrologyReport() {
        const name = document.getElementById('fullName').value;
        const birthDate = document.getElementById('birthDate').value;
        const birthTime = document.getElementById('birthTime').value;

        if (!name || !birthDate || !birthTime) {
            showError("Please fill in all astrology fields: Full Name, Birth Date, and Birth Time.");
            return;
        }

        showLoading('astrologyLoading', 'astrologyResults');

        setTimeout(() => {
            // --- Simulate complex data fetching ---
            const signs = ['Aries', 'Taurus', 'Gemini', 'Cancer', 'Leo', 'Virgo'];
            const sunSign = signs[Math.floor(Math.random() * signs.length)];
            const moonSign = signs[Math.floor(Math.random() * signs.length)];
            const ascendant = signs[Math.floor(Math.random() * signs.length)];
            
            generatedReportData.astrology = {
                name,
                birthDate,
                title: "Comprehensive Astrological Profile",
                sections: [
                    {
                        title: "Introduction: Your Cosmic Blueprint",
                        content: `This report delves into the core components of your natal chart, providing a snapshot of the energies that shape your personality, motivations, and life path. Prepared for ${name}, born on ${new Date(birthDate).toLocaleDateString()}.`
                    },
                    {
                        title: "The Three Pillars: Sun, Moon, and Ascendant",
                        content: `Your personality is built upon three key pillars: your Sun Sign (your core identity), your Moon Sign (your emotional world), and your Ascendant (how you appear to others and approach the world).`
                    },
                    {
                        title: `Your Sun in ${sunSign}`,
                        content: ANALYSIS_CONTENT.astrology.sunSign[sunSign] || "Interpretation for this sign is not available."
                    },
                    {
                        title: `Your Moon in ${moonSign}`,
                        content: ANALYSIS_CONTENT.astrology.moonSign[moonSign] || "Interpretation for this sign is not available."
                    },
                    {
                        title: `Your ${ascendant} Ascendant`,
                        content: ANALYSIS_CONTENT.astrology.ascendant[ascendant] || "Interpretation for this sign is not available."
                    },
                    {
                        title: "Key Planetary Placement: Jupiter in the 10th House",
                        content: ANALYSIS_CONTENT.astrology.planetsInHouses['Jupiter in 10th']
                    }
                ]
            };

            hideLoading('astrologyLoading', 'astrologyResults');
        }, 1500);
    }

    function generateNumerologyReport() {
        const name = document.getElementById('numFullName').value;
        const birthDate = document.getElementById('numBirthDate').value;

        if (!name || !birthDate) {
            showError("Please provide both full name and birth date for numerology.");
            return;
        }

        showLoading('numerologyLoading', 'numerologyResults');

        setTimeout(() => {
             // --- Simulate complex calculations ---
            const lifePath = [1, 8, 22][Math.floor(Math.random() * 3)];
            const destiny = [5, 9][Math.floor(Math.random() * 2)];

            generatedReportData.numerology = {
                name,
                birthDate,
                title: "Comprehensive Numerology Profile",
                sections: [
                     {
                        title: "Introduction: The Numbers of Your Life",
                        content: `Numerology reveals the blueprint of your life through the energetic vibration of numbers. This report explores your core numbers to illuminate your purpose, talents, and destiny. Prepared for ${name}.`
                    },
                    {
                        title: `Your Life Path Number: ${lifePath}`,
                        content: ANALYSIS_CONTENT.numerology.lifePath[lifePath] || "Interpretation not available."
                    },
                    {
                        title: `Your Destiny (Expression) Number: ${destiny}`,
                        content: ANALYSIS_CONTENT.numerology.destiny[destiny] || "Interpretation not available."
                    },
                     {
                        title: "Synthesis & Conclusion",
                        content: `Your Life Path number of ${lifePath} combined with a Destiny number of ${destiny} creates a powerful dynamic. You are here to be a ${lifePath === 22 ? 'master builder' : 'leader'}, and your path to achieving this is through ${destiny === 5 ? 'embracing change and freedom' : 'humanitarian efforts'}. This combination suggests a life of significant impact.`
                    }
                ]
            };

            hideLoading('numerologyLoading', 'numerologyResults');
        }, 1500);
    }


    // --- PROFESSIONAL EXPORT FUNCTIONS --- //

    async function svgToBase64(svgElement) {
        const serializer = new XMLSerializer();
        const svgString = serializer.serializeToString(svgElement);
        const svgBlob = new Blob([svgString], {type: "image/svg+xml;charset=utf-8"});
        return new Promise(resolve => {
            const reader = new FileReader();
            reader.onloadend = () => resolve(reader.result);
            reader.readAsDataURL(svgBlob);
        });
    }

    async function exportPDF() {
        if (!generatedReportData.astrology && !generatedReportData.numerology) {
            showError("Please generate at least one report before exporting.");
            return;
        }

        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const logoSvg = document.querySelector("#logo-container svg");
        const logoBase64 = await svgToBase64(logoSvg);
        
        const pageHeight = doc.internal.pageSize.height;
        const pageWidth = doc.internal.pageSize.width;
        const margin = 20;
        let cursorY = margin;

        const addHeader = (title) => {
            doc.addImage(logoBase64, 'SVG', margin, margin - 10, 15, 15);
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(16);
            doc.text("Cosmic Insights AI", margin + 20, margin);
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(12);
            doc.text(title, pageWidth - margin, margin, { align: 'right' });
            doc.line(margin, margin + 5, pageWidth - margin, margin + 5);
            cursorY = margin + 20;
        };

        const addFooter = (pageNumber) => {
            doc.setFontSize(8);
            doc.text(`Generated on: ${new Date().toLocaleDateString()}`, margin, pageHeight - 10);
            doc.text(`Page ${pageNumber}`, pageWidth - margin, pageHeight - 10, { align: 'right' });
        };
        
        const checkPageBreak = (neededHeight) => {
            if (cursorY + neededHeight > pageHeight - margin) {
                addFooter(doc.internal.getNumberOfPages());
                doc.addPage();
                cursorY = margin;
                addHeader(doc.title);
            }
        };

        const printSection = (title, content) => {
            const titleHeight = 10;
            const contentLines = doc.splitTextToSize(content, pageWidth - margin * 2);
            const contentHeight = contentLines.length * 5; // Approximate height
            
            checkPageBreak(titleHeight + contentHeight);

            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text(title, margin, cursorY);
            cursorY += 8;

            doc.setFontSize(11);
            doc.setFont('helvetica', 'normal');
            doc.text(contentLines, margin, cursorY);
            cursorY += contentHeight + 5;
        };

        let pageCount = 1;
        
        if (generatedReportData.astrology) {
            doc.title = "Astrology Report";
            addHeader(generatedReportData.astrology.title);
            generatedReportData.astrology.sections.forEach(section => {
                printSection(section.title, section.content);
            });
        }
        
        if (generatedReportData.numerology) {
            if (generatedReportData.astrology) {
                addFooter(pageCount++);
                doc.addPage();
                cursorY = margin;
            }
            doc.title = "Numerology Report";
            addHeader(generatedReportData.numerology.title);
            generatedReportData.numerology.sections.forEach(section => {
                printSection(section.title, section.content);
            });
        }

        addFooter(pageCount);
        doc.save('AI-Cosmic-Report.pdf');
        document.getElementById('reportStatus').textContent = "PDF successfully exported!";
    }

    async function exportDOCX() {
        if (!generatedReportData.astrology && !generatedReportData.numerology) {
            showError("Please generate at least one report before exporting.");
            return;
        }

        const logoSvg = document.querySelector("#logo-container svg");
