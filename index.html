<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced AI Astrology & Numerology Analysis</title>
    <!-- Adding jsPDF and docx libraries for export functionality -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/docx@8.5.0/build/index.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #3b4371 100%);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            padding: 40px 0;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ffd700, #ffb347, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
        }
        
        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .nav-tab {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            font-size: 1rem;
            font-weight: 600;
        }
        
        .nav-tab.active {
            background: linear-gradient(45deg, #ffd700, #ffb347);
            color: #000;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 215, 0, 0.3);
        }
        
        .nav-tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 255, 255, 0.2);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .input-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .input-group label {
            font-weight: 600;
            color: #ffd700;
            font-size: 1.1rem;
        }
        
        .input-group input,
        .input-group select,
        .input-group textarea {
            padding: 12px 16px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 1rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .input-group input:focus,
        .input-group select:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #ffd700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
        }
        
        .input-group input::placeholder,
        .input-group textarea::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .generate-btn {
            padding: 15px 40px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(45deg, #ffd700, #ffb347);
            color: #000;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-size: 1.1rem;
            letter-spacing: 1px;
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }
        
        .generate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(255, 215, 0, 0.5);
        }
        
        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .results-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .chart-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .chart-wheel {
            width: 100%;
            max-width: 400px;
            height: 400px;
            border-radius: 50%;
            margin: 0 auto;
            position: relative;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            border: 4px solid rgba(255, 215, 0, 0.7);
            box-shadow: 0 0 60px rgba(255, 215, 0, 0.4);
        }
        
        .houses {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .house {
            position: absolute;
            width: 2px;
            height: 50%;
            background: rgba(255, 255, 255, 0.4);
            transform-origin: bottom center;
            left: 50%;
            bottom: 50%;
        }
        
        .planets-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .planet {
            position: absolute;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            transform: translate(-50%, -50%);
            border: 3px solid rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .planet:hover {
            transform: translate(-50%, -50%) scale(1.3);
            box-shadow: 0 0 25px rgba(255, 255, 255, 0.8);
            z-index: 10;
        }
        
        .ai-insights {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 179, 71, 0.2));
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.2);
        }
        
        .ai-insights h3 {
            color: #ffd700;
            margin-bottom: 20px;
            font-size: 1.5rem;
            text-align: center;
        }
        
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .analysis-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .analysis-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
            border-color: rgba(255, 215, 0, 0.5);
        }
        
        .analysis-card h4 {
            color: #ffd700;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .numerology-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .number-card {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 179, 71, 0.1));
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 2px solid rgba(255, 215, 0, 0.3);
            transition: all 0.3s ease;
        }
        
        .number-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(255, 215, 0, 0.3);
        }
        
        .number-card .number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 10px;
        }
        
        .number-card .title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: #fff;
        }
        
        .number-card .description {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #ffd700;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .ai-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .ai-button {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(45deg, #4c63d2, #6b73ff);
            color: #fff;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 0.5px;
        }
        
        .ai-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(76, 99, 210, 0.4);
        }
        
        .ai-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .compatibility-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            margin-top: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .error-message {
            display: none;
            background: rgba(255, 0, 0, 0.2);
            border: 2px solid rgba(255, 0, 0, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            color: #ff6b6b;
            text-align: center;
        }
        
        .success-message {
            background: rgba(0, 255, 0, 0.2);
            border: 2px solid rgba(0, 255, 0, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            color: #51cf66;
            text-align: center;
        }
        
        .compatibility-meter {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .compatibility-fill {
            height: 100%;
            background: linear-gradient(45deg, #ff6b6b, #ffd700, #51cf66);
            transition: width 2s ease;
        }
        
        .ai-model-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .ai-model-selector h3 {
            color: #ffd700;
            margin-right: 10px;
        }
        
        .ai-model-button {
            padding: 8px 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .ai-model-button.active {
            background: linear-gradient(45deg, #ffd700, #ffb347);
            color: #000;
            border-color: #ffd700;
        }
        
        .prediction-timeline {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .prediction-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .prediction-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
        }
        
        .prediction-date {
            color: #ffd700;
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 10px;
        }
        
        .confidence-score {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .confidence-bar {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .confidence-fill {
            height: 100%;
            background: linear-gradient(45deg, #ffd700, #ffb347);
            transition: width 1s ease;
        }

        .report-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .export-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .export-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(45deg, #28a745, #20c997);
            color: #fff;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 0.5px;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(40, 167, 69, 0.4);
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .chart-container {
                grid-template-columns: 1fr;
            }
            
            .input-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-wheel {
                width: 300px;
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🌟 Advanced AI Astrology & Numerology Analysis 🌟</h1>
            <p>Professional-Grade Astrological & Numerological Insights with AI Integration</p>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('astrology')">🌙 Astrology</button>
            <button class="nav-tab" onclick="switchTab('numerology')">🔢 Numerology</button>
            <button class="nav-tab" onclick="switchTab('compatibility')">💕 Compatibility</button>
            <button class="nav-tab" onclick="switchTab('predictions')">🔮 Predictions</button>
            <button class="nav-tab" onclick="switchTab('reports')">📊 Reports</button>
        </div>

        <div id="errorMessage" class="error-message"></div>
        
        <!-- Astrology Tab -->
        <div id="astrology" class="tab-content active">
            <div class="input-section">
                <h2>🌟 Birth Chart Analysis</h2>
                <div class="input-grid">
                    <div class="input-group">
                        <label for="fullName">Full Name</label>
                        <input type="text" id="fullName" placeholder="Enter your full name" value="Jane Doe">
                    </div>
                    <div class="input-group">
                        <label for="birthDate">Birth Date</label>
                        <input type="date" id="birthDate" value="1990-07-15">
                    </div>
                    <div class="input-group">
                        <label for="birthTime">Birth Time</label>
                        <input type="time" id="birthTime" value="14:30">
                    </div>
                    <div class="input-group">
                        <label for="birthLocation">Birth Location</label>
                        <input type="text" id="birthLocation" placeholder="City, Country" value="New York, USA">
                    </div>
                </div>
                
                <button class="generate-btn" onclick="generateAstrologyReport()">🔮 Generate AI Astrology Report</button>
            </div>
            
            <div class="loading" id="astrologyLoading">
                <div class="spinner"></div>
                <p>AI is analyzing your birth chart...</p>
            </div>
            
            <div class="results-section" id="astrologyResults" style="display: none;">
                <h2>🌟 Your Personalized Astrology Report</h2>
                <div id="birthInfo" class="ai-insights"></div>
                
                <div class="chart-container">
                    <div>
                        <h3>🎯 Natal Chart Wheel</h3>
                        <div class="chart-wheel" id="chartWheel">
                            <div class="houses"></div>
                            <div class="planets-container"></div>
                        </div>
                    </div>
                    
                    <div>
                        <h3>🧠 AI Analysis Dashboard</h3>
                        <div class="ai-controls">
                            <button class="ai-button" onclick="showAstrologyInsight('personality')">🔮 Personality</button>
                            <button class="ai-button" onclick="showAstrologyInsight('career')">💼 Career</button>
                            <button class="ai-button" onclick="showAstrologyInsight('love')">❤️ Love</button>
                        </div>
                        <div class="ai-insights" id="aiInsights">
                            <h3>🤖 AI-Generated Insights</h3>
                            <p>Your personalized astrology report has been generated. Click a button above to dive deeper.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Numerology Tab -->
        <div id="numerology" class="tab-content">
            <div class="input-section">
                <h2>🔢 Numerology Analysis</h2>
                <div class="input-grid">
                    <div class="input-group">
                        <label for="numFullName">Full Name (as on birth certificate)</label>
                        <input type="text" id="numFullName" placeholder="Enter your complete legal name" value="Jane Elizabeth Doe">
                    </div>
                    <div class="input-group">
                        <label for="numBirthDate">Birth Date</label>
                        <input type="date" id="numBirthDate" value="1990-07-15">
                    </div>
                </div>
                <button class="generate-btn" onclick="generateNumerologyReport()">🔮 Generate AI Numerology Report</button>
            </div>
            
            <div class="loading" id="numerologyLoading">
                <div class="spinner"></div>
                <p>AI is calculating your numerology profile...</p>
            </div>
            
            <div class="results-section" id="numerologyResults" style="display: none;">
                <h2>🔢 Your Numerology Profile</h2>
                <div class="numerology-grid" id="numerologyNumbers"></div>
                <div class="ai-insights" id="numerologyAIInsights">
                    <h3>🤖 AI Numerology Insights</h3>
                    <p>Your numerology profile has been calculated. Here is a summary of your core numbers.</p>
                </div>
            </div>
        </div>
        
        <!-- Compatibility Tab -->
        <div id="compatibility" class="tab-content">
            <div class="input-section">
                <h2>💕 Compatibility Analysis</h2>
                <div class="input-grid">
                    <div class="input-group">
                        <label for="person1Name">Person 1 Name</label>
                        <input type="text" id="person1Name" placeholder="First person's name" value="Jane Doe">
                    </div>
                    <div class="input-group">
                        <label for="person1Date">Person 1 Birth Date</label>
                        <input type="date" id="person1Date" value="1990-07-15">
                    </div>
                    <div class="input-group">
                        <label for="person2Name">Person 2 Name</label>
                        <input type="text" id="person2Name" placeholder="Second person's name" value="John Smith">
                    </div>
                    <div class="input-group">
                        <label for="person2Date">Person 2 Birth Date</label>
                        <input type="date" id="person2Date" value="1988-11-25">
                    </div>
                </div>
                <button class="generate-btn" onclick="generateCompatibilityReport()">💫 Generate Compatibility Report</button>
            </div>
            
            <div class="loading" id="compatibilityLoading">
                <div class="spinner"></div>
                <p>AI is analyzing compatibility patterns...</p>
            </div>
            
            <div class="results-section" id="compatibilityResults" style="display: none;">
                <h2>💖 Compatibility Report for Jane Doe & John Smith</h2>
                <div class="ai-insights">
                    <h3>Compatibility Score: <span id="compatibilityScore"></span>%</h3>
                    <div class="compatibility-meter">
                        <div class="compatibility-fill" id="compatibilityFill" style="width: 0%;"></div>
                    </div>
                    <p id="compatibilityAnalysisText"></p>
                </div>
            </div>
        </div>

        <!-- Predictions Tab -->
        <div id="predictions" class="tab-content">
            <div class="input-section">
                <h2>🔮 AI-Powered Predictions</h2>
                <div class="input-grid">
                     <div class="input-group">
                        <label for="predName">Full Name</label>
                        <input type="text" id="predName" placeholder="Enter your full name" value="Jane Doe">
                    </div>
                    <div class="input-group">
                        <label for="predBirthDate">Birth Date</label>
                        <input type="date" id="predBirthDate" value="1990-07-15">
                    </div>
                    <div class="input-group">
                        <label for="predictionTimeframe">Select Timeframe</label>
                        <select id="predictionTimeframe">
                            <option value="3">Next 3 Months</option>
                            <option value="6">Next 6 Months</option>
                            <option value="12">Next Year</option>
                        </select>
                    </div>
                </div>
                <button class="generate-btn" onclick="generatePredictions()">🚀 Generate Predictions</button>
            </div>

            <div class="loading" id="predictionsLoading">
                <div class="spinner"></div>
                <p>AI is forecasting future trends...</p>
            </div>

            <div class="results-section" id="predictionsResults" style="display: none;">
                 <h2>🔮 Your Personalized Predictions</h2>
                 <div class="prediction-timeline" id="predictionTimeline"></div>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reports" class="tab-content">
            <div class="report-section">
                <h2>📊 Export Your Reports</h2>
                <p>Compile your generated Astrology, Numerology, and Compatibility insights into a single downloadable file. Please generate a report from the other tabs first.</p>
                <div class="export-controls">
                    <button class="export-btn" onclick="exportPDF()">📄 Export as PDF</button>
                    <button class="export-btn" onclick="exportDOCX()">📝 Export as DOCX</button>
                </div>
                <div id="reportStatus"></div>
            </div>
        </div>

    </div>

    <script>
        // --- Global State & Data --- //
        let generatedReportData = {}; 

        // --- Tab Management --- //
        function switchTab(tabName) {
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector(`.nav-tab[onclick="switchTab('${tabName}')"]`).classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
        }

        function showLoading(loaderId, resultsId) {
            document.getElementById(loaderId).style.display = 'block';
            document.getElementById(resultsId).style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
        }

        function hideLoading(loaderId, resultsId) {
            document.getElementById(loaderId).style.display = 'none';
            document.getElementById(resultsId).style.display = 'block';
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            // Hide all loaders
            document.querySelectorAll('.loading').forEach(loader => loader.style.display = 'none');
        }

        // --- Astrology Functions --- //
        function getZodiacSign(date) {
            const day = date.getDate();
            const month = date.getMonth() + 1;
            if ((month == 1 && day >= 20) || (month == 2 && day <= 18)) return "Aquarius";
            if ((month == 2 && day >= 19) || (month == 3 && day <= 20)) return "Pisces";
            if ((month == 3 && day >= 21) || (month == 4 && day <= 19)) return "Aries";
            if ((month == 4 && day >= 20) || (month == 5 && day <= 20)) return "Taurus";
            if ((month == 5 && day >= 21) || (month == 6 && day <= 20)) return "Gemini";
            if ((month == 6 && day >= 21) || (month == 7 && day <= 22)) return "Cancer";
            if ((month == 7 && day >= 23) || (month == 8 && day <= 22)) return "Leo";
            if ((month == 8 && day >= 23) || (month == 9 && day <= 22)) return "Virgo";
            if ((month == 9 && day >= 23) || (month == 10 && day <= 22)) return "Libra";
            if ((month == 10 && day >= 23) || (month == 11 && day <= 21)) return "Scorpio";
            if ((month == 11 && day >= 22) || (month == 12 && day <= 21)) return "Sagittarius";
            if ((month == 12 && day >= 22) || (month == 1 && day <= 19)) return "Capricorn";
        }

        function generateAstrologyReport() {
            const name = document.getElementById('fullName').value;
            const birthDate = document.getElementById('birthDate').value;
            const birthTime = document.getElementById('birthTime').value;

            if (!name || !birthDate || !birthTime) {
                showError("Please fill in all astrology fields: Full Name, Birth Date, and Birth Time.");
                return;
            }

            showLoading('astrologyLoading', 'astrologyResults');

            // Simulate API call and AI processing
            setTimeout(() => {
                const date = new Date(birthDate);
                const zodiacSign = getZodiacSign(date);

                // Mock data for chart - in a real app, this would come from an API
                const planets = [
                    { name: 'Sun', symbol: '☉', degree: Math.random() * 360, color: '#FFD700' },
                    { name: 'Moon', symbol: '☽', degree: Math.random() * 360, color: '#C0C0C0' },
                    { name: 'Mercury', symbol: '☿', degree: Math.random() * 360, color: '#8E8E8E' },
                    { name: 'Venus', symbol: '♀', degree: Math.random() * 360, color: '#E4717A' },
                    { name: 'Mars', symbol: '♂', degree: Math.random() * 360, color: '#FF4500' },
                    { name: 'Jupiter', symbol: '♃', degree: Math.random() * 360, color: '#4169E1' },
                    { name: 'Saturn', symbol: '♄', degree: Math.random() * 360, color: '#A9A9A9' },
                ];

                generatedReportData.astrology = {
                    name,
                    zodiacSign,
                    insights: {
                        personality: `As a ${zodiacSign}, you are known for your vibrant energy and charismatic presence. Your Sun placement suggests a core identity rooted in leadership and creative expression. People are naturally drawn to your warmth and confidence.`,
                        career: `In your career, your ${zodiacSign} traits suggest a path where you can inspire others. Fields like management, entrepreneurship, or the creative arts would be highly fulfilling. Your determination ensures you achieve your goals.`,
                        love: `In relationships, you seek a partner who matches your passion and intensity. As a ${zodiacSign}, you are loyal and generous, but require admiration and freedom. A strong, confident partner is your ideal match.`
                    },
                    planets
                };

                displayAstrologyResults(generatedReportData.astrology);
                hideLoading('astrologyLoading', 'astrologyResults');
            }, 2000);
        }

        function displayAstrologyResults(data) {
            document.getElementById('birthInfo').innerHTML = `<h3>${data.name} - ${data.zodiacSign}</h3>
                <p>Welcome to your AI-powered astrological analysis. Your natal chart reveals the unique cosmic blueprint of your life's potential.</p>`;
            
            const housesContainer = document.querySelector('#chartWheel .houses');
            const planetsContainer = document.querySelector('#chartWheel .planets-container');
            housesContainer.innerHTML = '';
            planetsContainer.innerHTML = '';

            // Draw houses
            for (let i = 0; i < 12; i++) {
                const house = document.createElement('div');
                house.className = 'house';
                house.style.transform = `rotate(${i * 30}deg)`;
                housesContainer.appendChild(house);
            }

            // Draw planets
            data.planets.forEach(planet => {
                const planetEl = document.createElement('div');
                planetEl.className = 'planet';
                planetEl.textContent = planet.symbol;
                planetEl.title = planet.name;
                planetEl.style.backgroundColor = planet.color;

                const angle = (planet.degree - 90) * (Math.PI / 180); // Adjust for CSS rotation
                const radius = 140; // Adjust to fit inside the wheel
                const x = 200 + radius * Math.cos(angle);
                const y = 200 + radius * Math.sin(angle);
                planetEl.style.left = `${x}px`;
                planetEl.style.top = `${y}px`;
                planetsContainer.appendChild(planetEl);
            });

            // Set initial insight
            showAstrologyInsight('personality');
        }
        
        function showAstrologyInsight(type) {
             if (generatedReportData.astrology && generatedReportData.astrology.insights[type]) {
                const insightText = generatedReportData.astrology.insights[type];
                document.getElementById('aiInsights').innerHTML = `<h3>🤖 AI ${type.charAt(0).toUpperCase() + type.slice(1)} Analysis</h3><p>${insightText}</p>`;
             } else {
                 showError("Please generate the astrology report first.");
             }
        }

        // --- Numerology Functions --- //
        function reduceNumber(n) {
            if (n === 11 || n === 22 || n === 33) return n;
            let sum = n.toString().split('').reduce((acc, digit) => acc + parseInt(digit), 0);
            return sum > 9 ? reduceNumber(sum) : sum;
        }

        function calculateNameNumber(name, type) {
            const vowels = 'aeiou';
            let sum = 0;
            const charValues = {
                'a':1, 'b':2, 'c':3, 'd':4, 'e':5, 'f':6, 'g':7, 'h':8, 'i':9,
                'j':1, 'k':2, 'l':3, 'm':4, 'n':5, 'o':6, 'p':7, 'q':8, 'r':9,
                's':1, 't':2, 'u':3, 'v':4, 'w':5, 'x':6, 'y':7, 'z':8
            };

            for (let char of name.toLowerCase()) {
                if (charValues[char]) {
                    if (type === 'vowels' && vowels.includes(char)) {
                        sum += charValues[char];
                    } else if (type === 'consonants' && !vowels.includes(char)) {
                        sum += charValues[char];
                    } else if (type === 'all') {
                        sum += charValues[char];
                    }
                }
            }
            return reduceNumber(sum);
        }
        
        function generateNumerologyReport() {
            const name = document.getElementById('numFullName').value;
            const birthDate = document.getElementById('numBirthDate').value;
            
            if (!name || !birthDate) {
                showError("Please provide both your full name and birth date for numerology calculation.");
                return;
            }

            showLoading('numerologyLoading', 'numerologyResults');

            setTimeout(() => {
                const date = new Date(birthDate);
                const day = date.getDate();
                const month = date.getMonth() + 1;
                const year = date.getFullYear();

                const lifePath = reduceNumber(day + month + year);
                const destiny = calculateNameNumber(name, 'all');
                const soulUrge = calculateNameNumber(name, 'vowels');
                const personality = calculateNameNumber(name, 'consonants');

                generatedReportData.numerology = {
                    name,
                    numbers: {
                        "Life Path": { value: lifePath, desc: "Your life's main lesson and purpose." },
                        "Destiny": { value: destiny, desc: "Your potential and what you must achieve." },
                        "Soul Urge": { value: soulUrge, desc: "Your inner desires and motivations." },
                        "Personality": { value: personality, desc: "How others see you; your outer self." }
                    }
                };

                displayNumerologyResults(generatedReportData.numerology);
                hideLoading('numerologyLoading', 'numerologyResults');
            }, 2000);
        }

        function displayNumerologyResults(data) {
            const container = document.getElementById('numerologyNumbers');
            container.innerHTML = '';
            for (const [title, details] of Object.entries(data.numbers)) {
                container.innerHTML += `
                    <div class="number-card">
                        <div class="number">${details.value}</div>
                        <div class="title">${title} Number</div>
                        <div class="description">${details.desc}</div>
                    </div>
                `;
            }
            const insights = document.getElementById('numerologyAIInsights');
            insights.innerHTML = `<h3>🤖 AI Numerology Insights</h3>
            <p>Your core numbers have been calculated. The Life Path number ${data.numbers['Life Path'].value} indicates a journey of leadership and innovation. Your Destiny number ${data.numbers.Destiny.value} suggests you are here to build something of lasting value. This combination points to a powerful and influential life path.</p>`;
        }


        // --- Compatibility Functions --- //
        function generateCompatibilityReport() {
            const name1 = document.getElementById('person1Name').value;
            const date1 = document.getElementById('person1Date').value;
            const name2 = document.getElementById('person2Name').value;
            const date2 = document.getElementById('person2Date').value;

            if (!name1 || !date1 || !name2 || !date2) {
                showError("Please fill in all fields for both people for a compatibility report.");
                return;
            }

            showLoading('compatibilityLoading', 'compatibilityResults');

            setTimeout(() => {
                const sign1 = getZodiacSign(new Date(date1));
                const sign2 = getZodiacSign(new Date(date2));
                
                // Simplified compatibility logic
                const zodiacCompatibility = {
                    'Aries': ['Leo', 'Sagittarius', 'Gemini', 'Aquarius'],
                    'Taurus': ['Virgo', 'Capricorn', 'Cancer', 'Pisces'],
                    'Gemini': ['Libra', 'Aquarius', 'Aries', 'Leo'],
                    'Cancer': ['Scorpio', 'Pisces', 'Taurus', 'Virgo'],
                    'Leo': ['Aries', 'Sagittarius', 'Gemini', 'Libra'],
                    'Virgo': ['Taurus', 'Capricorn', 'Cancer', 'Scorpio'],
                    'Libra': ['Gemini', 'Aquarius', 'Leo', 'Sagittarius'],
                    'Scorpio': ['Cancer', 'Pisces', 'Virgo', 'Capricorn'],
                    'Sagittarius': ['Aries', 'Leo', 'Libra', 'Aquarius'],
                    'Capricorn': ['Taurus', 'Virgo', 'Scorpio', 'Pisces'],
                    'Aquarius': ['Gemini', 'Libra', 'Aries', 'Sagittarius'],
                    'Pisces': ['Cancer', 'Scorpio', 'Taurus', 'Capricorn']
                };

                let score = 50 + (Math.random() * 20 - 10); // Base score
                if (zodiacCompatibility[sign1].includes(sign2)) {
                    score += 35;
                }
                score = Math.min(Math.max(Math.round(score), 30), 98); // Clamp score

                let analysisText = `The connection between a ${sign1} and a ${sign2} is often dynamic. `;
                if (score > 80) {
                    analysisText += "There is a powerful natural chemistry here, suggesting high levels of understanding and harmony. Both partners feel seen and supported.";
                } else if (score > 60) {
                    analysisText += "This is a strong pairing with excellent potential. While there may be some differences to navigate, the core connection is solid and can lead to a lasting bond.";
                } else {
                    analysisText += "This relationship requires effort and communication to thrive. There are key differences in your approaches to life, but with mutual respect, you can learn a great deal from each other.";
                }

                generatedReportData.compatibility = { name1, name2, score, analysis: analysisText };

                document.querySelector('#compatibilityResults h2').textContent = `💖 Compatibility Report for ${name1} & ${name2}`;
                document.getElementById('compatibilityScore').textContent = score;
                document.getElementById('compatibilityFill').style.width = `${score}%`;
                document.getElementById('compatibilityAnalysisText').textContent = analysisText;

                hideLoading('compatibilityLoading', 'compatibilityResults');
            }, 2000);
        }

        // --- Predictions Functions --- //
        function generatePredictions() {
            const name = document.getElementById('predName').value;
            const birthDate = document.getElementById('predBirthDate').value;
            if (!name || !birthDate) {
                showError("Please enter a name and birth date for predictions.");
                return;
            }
            
            showLoading('predictionsLoading', 'predictionsResults');
            
            setTimeout(() => {
                const predictions = [
                    { date: "Next Month", area: "Career", text: "An unexpected opportunity for growth may appear. Stay alert and be ready to act.", confidence: 85 },
                    { date: "In 2-3 Months", area: "Relationships", text: "A key conversation will bring clarity to a personal relationship. Honesty will be crucial.", confidence: 78 },
                    { date: "In 4-6 Months", area: "Finance", text: "A period of financial stability is ahead. A good time to review your long-term goals.", confidence: 92 },
                ];

                generatedReportData.predictions = { name, predictions };
                displayPredictions(generatedReportData.predictions);
                hideLoading('predictionsLoading', 'predictionsResults');
            }, 2000);
        }

        function displayPredictions(data) {
            const timeline = document.getElementById('predictionTimeline');
            timeline.innerHTML = '';
            document.querySelector('#predictionsResults h2').textContent = `🔮 Your Personalized Predictions for ${data.name}`;
            
            data.predictions.forEach(pred => {
                timeline.innerHTML += `
                    <div class="prediction-card">
                        <div class="prediction-date">${pred.date} - ${pred.area}</div>
                        <p>${pred.text}</p>
                        <div class="confidence-score">
                            <span>AI Confidence:</span>
                            <div class="confidence-bar">
                                <div class="confidence-fill" style="width: ${pred.confidence}%;"></div>
                            </div>
                            <span>${pred.confidence}%</span>
                        </div>
                    </div>
                `;
            });
        }


        // --- Report Export Functions --- //
        function getReportContentAsText() {
            if (Object.keys(generatedReportData).length === 0) {
                return "No data generated. Please use the other tabs to create reports first.";
            }

            let text = "Advanced AI Astrology & Numerology Report\n=======================================\n\n";

            if (generatedReportData.astrology) {
                const astro = generatedReportData.astrology;
                text += `ASTROLOGY REPORT for ${astro.name}\n`;
                text += `--------------------------------------\n`;
                text += `Zodiac Sign: ${astro.zodiacSign}\n\n`;
                text += `Personality Insight:\n${astro.insights.personality}\n\n`;
                text += `Career Insight:\n${astro.insights.career}\n\n`;
                text += `Love Insight:\n${astro.insights.love}\n\n`;
            }

            if (generatedReportData.numerology) {
                const neuro = generatedReportData.numerology;
                text += `NUMEROLOGY REPORT for ${neuro.name}\n`;
                text += `---------------------------------------\n`;
                for (const [title, details] of Object.entries(neuro.numbers)) {
                    text += `${title} Number: ${details.value}\n${details.desc}\n\n`;
                }
            }

             if (generatedReportData.compatibility) {
                const comp = generatedReportData.compatibility;
                text += `COMPATIBILITY REPORT for ${comp.name1} & ${comp.name2}\n`;
                text += `-------------------------------------------------\n`;
                text += `Overall Score: ${comp.score}%\n`;
                text += `AI Analysis: ${comp.analysis}\n\n`;
            }

            return text;
        }

        function exportPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const content = getReportContentAsText();

            if (content.startsWith("No data")) {
                document.getElementById('reportStatus').textContent = content;
                return;
            }

            doc.text(content, 10, 10, { maxWidth: 180 });
            doc.save('AI-Astrology-Numerology-Report.pdf');
            document.getElementById('reportStatus').textContent = "PDF successfully exported!";
        }

        function exportDOCX() {
            const content = getReportContentAsText();
            if (content.startsWith("No data")) {
                document.getElementById('reportStatus').textContent = content;
                return;
            }
            
            const paragraphs = content.split('\n').map(p => new docx.Paragraph({ text: p }));

            const doc = new docx.Document({
                sections: [{
                    properties: {},
                    children: paragraphs,
                }],
            });

            docx.Packer.toBlob(doc).then(blob => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement("a");
                a.href = url;
                a.download = "AI-Astrology-Numerology-Report.docx";
                a.click();
                URL.revokeObjectURL(url);
                document.getElementById('reportStatus').textContent = "DOCX successfully exported!";
            });
        }

    </script>
</body>
</html>
