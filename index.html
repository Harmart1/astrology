<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced AI Astrology & Numerology Analysis</title>
    <!-- Libraries for Professional Exports -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/docx@8.5.0/build/index.js"></script>
    <style>
        /* CSS has been slightly adjusted for the new UI elements, but is largely the same */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #3b4371 100%); color: #fff; min-height: 100vh; overflow-x: hidden; }
        .container { max-width: 1600px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; padding: 40px 0; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(15px); border-radius: 25px; margin-bottom: 30px; border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3); }
        h1 { font-size: 3rem; margin-bottom: 10px; background: linear-gradient(45deg, #ffd700, #ffb347, #ff6b6b); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-shadow: 0 0 30px rgba(255, 215, 0, 0.5); }
        .nav-tabs { display: flex; gap: 10px; margin-bottom: 30px; flex-wrap: wrap; justify-content: center; }
        .nav-tab { padding: 15px 30px; border: none; border-radius: 25px; background: rgba(255, 255, 255, 0.1); color: #fff; cursor: pointer; transition: all 0.3s ease; backdrop-filter: blur(10px); font-size: 1rem; font-weight: 600; }
        .nav-tab.active { background: linear-gradient(45deg, #ffd700, #ffb347); color: #000; transform: translateY(-2px); box-shadow: 0 10px 20px rgba(255, 215, 0, 0.3); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .input-section { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(15px); border-radius: 20px; padding: 30px; margin-bottom: 30px; border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); }
        .input-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .input-group { display: flex; flex-direction: column; gap: 8px; }
        .input-group label { font-weight: 600; color: #ffd700; font-size: 1.1rem; }
        .input-group input, .input-group select { padding: 12px 16px; border: 2px solid rgba(255, 255, 255, 0.2); border-radius: 10px; background: rgba(255, 255, 255, 0.1); color: #fff; font-size: 1rem; }
        .generate-btn { padding: 15px 40px; border: none; border-radius: 25px; background: linear-gradient(45deg, #ffd700, #ffb347); color: #000; font-weight: bold; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; font-size: 1.1rem; }
        .loading { display: none; text-align: center; padding: 40px; }
        .spinner { border: 4px solid rgba(255, 255, 255, 0.3); border-top: 4px solid #ffd700; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .error-message { display: none; background: rgba(255, 0, 0, 0.2); border: 2px solid rgba(255, 0, 0, 0.5); border-radius: 10px; padding: 15px; margin-bottom: 20px; text-align: center; }
        .results-section { background: rgba(0,0,0,0.2); border-radius: 20px; padding: 30px; display: none; }
        .results-section h2 { color: #ffd700; text-align: center; font-size: 2rem; margin-bottom: 20px;}
        .results-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; }
        .result-card { background: rgba(255,255,255,0.05); padding: 25px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.2); }
        .result-card h3 { color: #ffb347; border-bottom: 1px solid #ffb347; padding-bottom: 10px; margin-bottom: 15px; }
        .report-section { text-align: center; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(15px); border-radius: 20px; padding: 30px; margin-bottom: 30px; }
        .export-btn { padding: 12px 24px; border: none; border-radius: 25px; background: linear-gradient(45deg, #28a745, #20c997); color: #fff; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>
    <div id="logo-container" style="display: none;">
        <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="#ffd700" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2z"></path><path d="M12 12l-8 4.5"></path><path d="M12 12l8 4.5"></path><path d="M12 12l-8-4.5"></path><path d="M12 12l8-4.5"></path>
            <path d="M12 12l0 9"></path><path d="M12 12l0-9"></path>
        </svg>
    </div>

    <div class="container">
        <div class="header">
            <h1>Advanced AI Analysis</h1>
            <p>Astrology & Numerology Professional Suite</p>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('astrology')">üåô Astrology</button>
            <button class="nav-tab" onclick="switchTab('numerology')">üî¢ Numerology</button>
            <button class="nav-tab" onclick="switchTab('reports')">üìä Export Reports</button>
        </div>

        <div id="errorMessage" class="error-message"></div>
        
        <div id="astrology" class="tab-content active">
            <div class="input-section">
                <h2>Generate Astrological Profile</h2>
                <div class="input-grid">
                    <div class="input-group"><label for="fullName">Full Name</label><input type="text" id="fullName" value="Jane Doe"></div>
                    <div class="input-group"><label for="birthDate">Birth Date</label><input type="date" id="birthDate" value="1990-07-15"></div>
                    <div class="input-group"><label for="birthTime">Birth Time</label><input type="time" id="birthTime" value="14:30"></div>
                    <div class="input-group"><label for="birthLocation">Birth Location</label><input type="text" id="birthLocation" placeholder="City, Country" value="New York, USA"></div>
                </div>
                <button class="generate-btn" onclick="generateAstrologyReport()">üîÆ Generate Astrology Report</button>
            </div>
            <div class="loading" id="astrologyLoading"><div class="spinner"></div><p>AI is analyzing cosmic patterns...</p></div>
            <div class="results-section" id="astrologyResults"></div>
        </div>
        
        <div id="numerology" class="tab-content">
            <div class="input-section">
                <h2>Generate Numerology Profile</h2>
                <div class="input-grid">
                    <div class="input-group"><label for="numFullName">Full Birth Name</label><input type="text" id="numFullName" value="Jane Elizabeth Doe"></div>
                    <div class="input-group"><label for="numCurrentName">Current Name (if different)</label><input type="text" id="numCurrentName" placeholder="e.g., Jane Smith"></div>
                    <div class="input-group"><label for="numBirthDate">Birth Date</label><input type="date" id="numBirthDate" value="1990-07-15"></div>
                </div>
                <button class="generate-btn" onclick="generateNumerologyReport()">üîÆ Generate Numerology Report</button>
            </div>
            <div class="loading" id="numerologyLoading"><div class="spinner"></div><p>AI is calculating vibrational data...</p></div>
            <div class="results-section" id="numerologyResults"></div>
        </div>

        <div id="reports" class="tab-content">
            <div class="report-section">
                <h2>Download Your Professional Reports</h2>
                <p>Generate reports on the other tabs first. Then, export them here.</p>
                <div class="export-controls">
                    <button class="export-btn" onclick="exportPDF()">üìÑ Export as PDF</button>
                    <button class="export-btn" onclick="exportDOCX()">üìù Export as DOCX</button>
                </div>
                <div id="reportStatus"></div>
            </div>
        </div>
    </div>

    <script>
        // --- GLOBAL STATE & "AI" CONTENT LIBRARY (ABBREVIATED FOR BREVITY) --- //
        let generatedReportData = {};

        const ANALYSIS_CONTENT = {
            zodiac: {
                Aries: "Aries represents initiation, courage, and directness...", Leo: "Leo is the sign of royalty, creativity, and performance...", Cancer: "Cancer governs the realm of emotions, home, and nurturing...",
                // ... All 12 signs needed for full functionality
            },
            planets: {
                Sun: "The Sun represents your core identity, ego, and life force...", Moon: "The Moon governs your emotional world, instincts, and subconscious...",
                // ... Mercury, Venus, Mars etc.
            },
            aspects: {
                "Sun square Saturn": "A challenging aspect (square) between your ego (Sun) and your sense of discipline (Saturn) indicates a core life lesson around self-worth. You may struggle with harsh self-criticism, but have the potential to build incredible inner strength and authority.",
                "Venus trine Jupiter": "A harmonious aspect (trine) between Venus (love, values) and Jupiter (expansion, luck) blesses you with social grace and optimism in relationships. You attract generosity from others and have a deep appreciation for beauty and culture.",
                 // ... More aspects
            },
            numerology: {
                lifePath: { 1: "A path of leadership...", 8: "A path of material mastery...", 22: "The Master Builder's path..." },
                destiny: { 5: "A destiny of freedom...", 9: "A destiny of humanitarianism..." },
                soulUrge: { 6: "An inner need for domestic harmony...", 1: "A deep desire for independence..." },
                pinnacles: { 1: "A period to focus on independence and new beginnings...", 6: "A period where responsibility and family take center stage..." }
                 // ... Many more numbers
            }
        };

        // --- CORE UI & HELPER FUNCTIONS --- //
        function switchTab(tabName){ document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active')); document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active'); document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active')); document.getElementById(tabName).classList.add('active'); }
        function showLoading(loaderId, resultsId){ document.getElementById(loaderId).style.display='block'; document.getElementById(resultsId).style.display='none'; document.getElementById('errorMessage').style.display='none'; }
        function hideLoading(loaderId, resultsId){ document.getElementById(loaderId).style.display='none'; document.getElementById(resultsId).style.display='block'; }
        function showError(message){ const e=document.getElementById('errorMessage'); e.textContent=message; e.style.display='block'; document.querySelectorAll('.loading').forEach(l=>l.style.display='none'); }

        // --- DETERMINISTIC ASTROLOGY "CALCULATION" --- //
        function getZodiacSign(date) { const d=new Date(date); const day=d.getDate(); const m=d.getMonth()+1; if((m==3&&day>=21)||(m==4&&day<=19))return'Aries'; if((m==4&&day>=20)||(m==5&&day<=20))return'Taurus'; if((m==5&&day>=21)||(m==6&&day<=20))return'Gemini'; if((m==6&&day>=21)||(m==7&&day<=22))return'Cancer'; if((m==7&&day>=23)||(m==8&&day<=22))return'Leo'; if((m==8&&day>=23)||(m==9&&day<=22))return'Virgo'; if((m==9&&day>=23)||(m==10&&day<=22))return'Libra'; if((m==10&&day>=23)||(m==11&&day<=21))return'Scorpio'; if((m==11&&day>=22)||(m==12&&day<=21))return'Sagittarius'; return'Capricorn'; }
        function getAscendant(time) { const hour = parseInt(time.split(':')[0]); if (hour >= 6 && hour < 8) return 'Taurus'; if (hour >= 8 && hour < 10) return 'Gemini'; if (hour >= 10 && hour < 12) return 'Cancer'; if (hour >= 12 && hour < 14) return 'Leo'; if (hour >= 14 && hour < 16) return 'Virgo'; if (hour >= 16 && hour < 18) return 'Libra'; return 'Aries'; }

        function generateAstrologyReport() {
            const name = document.getElementById('fullName').value;
            const birthDate = document.getElementById('birthDate').value;
            const birthTime = document.getElementById('birthTime').value;
            if (!name || !birthDate || !birthTime) { showError("Please complete all input fields for an accurate analysis."); return; }
            
            showLoading('astrologyLoading', 'astrologyResults');

            setTimeout(() => {
                const sunSign = getZodiacSign(birthDate);
                const ascendant = getAscendant(birthTime);
                const moonSign = getZodiacSign(new Date(new Date(birthDate).getTime() + 15 * 86400000)); // Simulate a different moon sign

                const report = {
                    type: "Astrology",
                    person: { name, birthDate, birthTime },
                    title: `Astrological Profile for ${name}`,
                    summary: `This report details the core astrological energies influencing your life, based on your birth data. It provides insights into your identity, emotional nature, and key life themes.`,
                    data: [
                        { title: "Sun Sign", value: sunSign, interpretation: ANALYSIS_CONTENT.zodiac[sunSign] },
                        { title: "Moon Sign", value: moonSign, interpretation: ANALYSIS_CONTENT.zodiac[moonSign] },
                        { title: "Ascendant", value: ascendant, interpretation: ANALYSIS_CONTENT.zodiac[ascendant] },
                        { title: "Major Aspect", value: "Sun square Saturn", interpretation: ANALYSIS_CONTENT.aspects["Sun square Saturn"] },
                        { title: "Major Aspect", value: "Venus trine Jupiter", interpretation: ANALYSIS_CONTENT.aspects["Venus trine Jupiter"] },
                    ]
                };
                generatedReportData.astrology = report;
                displayReportResults('astrologyResults', report);
                hideLoading('astrologyLoading', 'astrologyResults');
            }, 1500);
        }

        // --- ACCURATE NUMEROLOGY CALCULATION --- //
        function reduceNumber(n) { if (n === 11 || n === 22 || n === 33) return n; let s = n.toString(); while (s.length > 1) { s = s.split('').reduce((a, b) => a + parseInt(b), 0).toString(); if (s === '11' || s === '22' || s === '33') return parseInt(s); } return parseInt(s); }
        function calculateNameNumber(name, type) { const vowels = 'aeiou'; const charValues = { 'a':1, 'j':1, 's':1, 'b':2, 'k':2, 't':2, 'c':3, 'l':3, 'u':3, 'd':4, 'm':4, 'v':4, 'e':5, 'n':5, 'w':5, 'f':6, 'o':6, 'x':6, 'g':7, 'p':7, 'y':7, 'h':8, 'q':8, 'z':8, 'i':9, 'r':9 }; let sum = 0; for (let char of name.toLowerCase()) { if (charValues[char]) { if (type === 'vowels' && vowels.includes(char)) sum += charValues[char]; else if (type === 'consonants' && !vowels.includes(char)) sum += charValues[char]; else if (type === 'all') sum += charValues[char]; } } return reduceNumber(sum); }

        function generateNumerologyReport() {
            const name = document.getElementById('numFullName').value;
            const birthDateStr = document.getElementById('numBirthDate').value;
            if (!name || !birthDateStr) { showError("Please provide full birth name and birth date."); return; }
            
            showLoading('numerologyLoading', 'numerologyResults');
            
            setTimeout(() => {
                const birthDate = new Date(birthDateStr);
                const day = birthDate.getDate(), month = birthDate.getMonth() + 1, year = birthDate.getFullYear();
                
                const report = {
                    type: "Numerology",
                    person: { name, birthDate: birthDateStr },
                    title: `Numerology Profile for ${name}`,
                    summary: `This report analyzes the vibrational meaning behind the numbers in your name and birth date, revealing your life path, destiny, and personal timeline.`,
                    data: [
                        { title: "Life Path Number", value: reduceNumber(day + month + year), interpretation: ANALYSIS_CONTENT.numerology.lifePath[reduceNumber(day + month + year)] },
                        { title: "Destiny Number", value: calculateNameNumber(name, 'all'), interpretation: ANALYSIS_CONTENT.numerology.destiny[calculateNameNumber(name, 'all')] },
                        { title: "Soul Urge Number", value: calculateNameNumber(name, 'vowels'), interpretation: ANALYSIS_CONTENT.numerology.soulUrge[calculateNameNumber(name, 'vowels')] },
                        { title: "First Pinnacle (Ages 0-35)", value: reduceNumber(day+month), interpretation: ANALYSIS_CONTENT.numerology.pinnacles[reduceNumber(day+month)] },
                        { title: "Second Pinnacle (Ages 36-44)", value: reduceNumber(day+year), interpretation: ANALYSIS_CONTENT.numerology.pinnacles[reduceNumber(day+year)] },
                    ]
                };
                generatedReportData.numerology = report;
                displayReportResults('numerologyResults', report);
                hideLoading('numerologyLoading', 'numerologyResults');
            }, 1500);
        }

        // --- DYNAMIC UI DISPLAY --- //
        function displayReportResults(containerId, report) {
            const container = document.getElementById(containerId);
            let html = `<h2>${report.title}</h2><p class="result-summary">${report.summary}</p><div class="results-grid">`;
            report.data.forEach(item => {
                html += `<div class="result-card"><h3>${item.title}: ${item.value}</h3><p>${item.interpretation}</p></div>`;
            });
            html += `</div>`;
            container.innerHTML = html;
        }

        // --- PROFESSIONAL EXPORT FUNCTIONS (ENHANCED) --- //
        async function svgToBase64(svgElement) { const s=new XMLSerializer().serializeToString(svgElement); return new Promise(r=>{const d=new FileReader();d.onloadend=()=>r(d.result);d.readAsDataURL(new Blob([s],{type:"image/svg+xml;charset=utf-8"}))}); }
        
        async function exportPDF() {
            if (!generatedReportData.astrology && !generatedReportData.numerology) { showError("Please generate at least one report first."); return; }
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'pt', 'a4');
            const logoBase64 = await svgToBase64(document.querySelector("#logo-container svg"));
            const pageHeight = doc.internal.pageSize.height, pageWidth = doc.internal.pageSize.width, margin = 40;
            let cursorY = 0;

            const addHeader = (title) => { doc.addImage(logoBase64, 'SVG', margin, margin - 15, 40, 40); doc.setFont('helvetica', 'bold'); doc.setFontSize(20); doc.text("Cosmic Insights AI", margin + 50, margin + 15); doc.setFont('helvetica', 'normal'); doc.setFontSize(12); doc.text(title, pageWidth - margin, margin + 15, { align: 'right' }); doc.setDrawColor("#ffb347"); doc.line(margin, margin + 35, pageWidth - margin, margin + 35); cursorY = margin + 60; };
            const addFooter = (page) => { doc.setFontSize(8).text(`Generated on ${new Date().toLocaleDateString()}`, margin, pageHeight - 20); doc.text(`Page ${page}`, pageWidth - margin, pageHeight - 20, { align: 'right' }); };
            
            const printReport = (report) => {
                addHeader(report.title);
                doc.setFont('helvetica', 'italic').setFontSize(10).text(doc.splitTextToSize(report.summary, pageWidth-margin*2), margin, cursorY);
                cursorY += 40;
                report.data.forEach(item => {
                    const textLines = doc.splitTextToSize(item.interpretation, pageWidth-margin*2 - 150);
                    const textHeight = textLines.length * doc.getFontSize();
                    if(cursorY + textHeight > pageHeight - 40) { addFooter(doc.internal.getNumberOfPages()); doc.addPage(); addHeader(report.title); }
                    
                    doc.setFont('helvetica', 'bold').setFontSize(12).text(item.title, margin, cursorY);
                    doc.setFont('helvetica', 'normal').setFontSize(11).text(item.value.toString(), margin + 140, cursorY, { align: 'left' });
                    doc.setFont('helvetica', 'normal').setFontSize(10).text(textLines, margin, cursorY + 15);
                    cursorY += textHeight + 30;
                });
                addFooter(doc.internal.getNumberOfPages());
            };
            
            if (generatedReportData.astrology) printReport(generatedReportData.astrology);
            if (generatedReportData.numerology) { if (generatedReportData.astrology) doc.addPage(); printReport(generatedReportData.numerology); }

            doc.save('AI-Cosmic-Analysis-Report.pdf');
        }

        async function exportDOCX() {
            if (!generatedReportData.astrology && !generatedReportData.numerology) { showError("Please generate at least one report first."); return; }
            const logoBuffer = await (await fetch(await svgToBase64(document.querySelector("#logo-container svg")))).arrayBuffer();

            const createReportSection = (report) => {
                const children = [ new docx.Paragraph({ text: report.summary, italic: true, spacing: { after: 240 } }) ];
                report.data.forEach(item => {
                    children.push(
                        new docx.Paragraph({ heading: docx.HeadingLevel.HEADING_2, children: [ new docx.TextRun(`${item.title}: ${item.value}`) ] }),
                        new docx.Paragraph({ children: [ new docx.TextRun(item.interpretation) ], spacing: { after: 200 } })
                    );
                });
                return children;
            };

            const sections = [];
            if(generatedReportData.astrology) {
                sections.push({
                    properties: { title: "Astrology Profile" },
                    headers: { default: new docx.Header({ children: [new docx.Paragraph({ children: [ new docx.ImageRun({ data: logoBuffer, transformation: { width: 40, height: 40 } }), new docx.TextRun({ text: `\t${generatedReportData.astrology.title}`, bold: true })] })] }) },
                    footers: { default: new docx.Footer({ children: [new docx.Paragraph({ alignment: docx.AlignmentType.CENTER, children: [new docx.TextRun("Page "), new docx.PageNumber()] })] })},
                    children: createReportSection(generatedReportData.astrology),
                });
            }
            if(generatedReportData.numerology) {
                 sections.push({
                    properties: { title: "Numerology Profile" },
                    headers: { default: new docx.Header({ children: [new docx.Paragraph({ children: [ new docx.ImageRun({ data: logoBuffer, transformation: { width: 40, height: 40 } }), new docx.TextRun({ text: `\t${generatedReportData.numerology.title}`, bold: true })] })] }) },
                    footers: { default: new docx.Footer({ children: [new docx.Paragraph({ alignment: docx.AlignmentType.CENTER, children: [new docx.TextRun("Page "), new docx.PageNumber()] })] })},
                    children: createReportSection(generatedReportData.numerology),
                });
            }
            
            const doc = new docx.Document({ sections });

            docx.Packer.toBlob(doc).then(blob => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement("a"); a.href = url; a.download = "AI-Cosmic-Analysis-Report.docx";
                a.click(); URL.revokeObjectURL(url);
            });
        }
    </script>
</body>
</html>
